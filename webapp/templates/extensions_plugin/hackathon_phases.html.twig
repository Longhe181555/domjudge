{% extends 'jury/base.html.twig' %}

{% block title %}Configure Phases - {{ contest.name }}{% endblock %}

{% block content %}
<ul class="nav nav-tabs mb-4">
    <li class="nav-item">
        <a class="nav-link" href="{{ path('jury_hackathon_display', {'contestId': contest.cid}) }}">Overview</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{{ path('jury_hackathon_problems', {'contestId': contest.cid}) }}">Problems</a>
    </li>
    <li class="nav-item">
        <a class="nav-link active" aria-current="page" href="#">Phases</a>
    </li>
</ul>
<div class="container mt-4">
    <h1>Configure Phases for <b>{{ contest.name }}</b></h1>
    {% if not displayData.allowPhase %}
        <div class="alert alert-warning">
            <b>Phases are currently <span class="text-danger">disabled</span> for this contest.</b><br>
            The contest is treated as a single phase. To enable multi-phase support, click the button below.<br>
        </div>
        <form method="post" action="{{ path('jury_hackathon_enable_phases', {'contestId': contest.cid}) }}" onsubmit="return confirm('Are you sure you want to enable phases? This action cannot be undone.');">
            <input type="hidden" name="_token" value="{{ csrf_token('enable_phases_' ~ contest.cid) }}">
            <button type="submit" class="btn btn-primary">Enable Phases</button>
        </form>
    {% else %}
        <div class="alert alert-info">Phases allow you to split the contest into multiple time periods (e.g., for hackathons or multi-stage events). Start/end times must be within the contest and not overlap.</div>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Name</th>
                    <th>Start Time</th>
                    <th>End Time</th>
                    <th>Allow Submit</th>
                    <th>Allow Manual Judge</th>
                    <th>Allow Automatic Judge</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
            {% for phase in phases %}
                <tr>
                    <td>{{ phase.phaseOrder }}</td>
                    <td>{{ phase.name }}</td>
                    <td>{{ phase.starttime }}</td>
                    <td>{{ phase.endtime }}</td>
                    <td>{{ phase.allowSubmit ? 'Yes' : 'No' }}</td>
                    <td>{{ phase.allowManualJudge ? 'Yes' : 'No' }}</td>
                    <td>{{ phase.allowAutomaticJudge ? 'Yes' : 'No' }}</td>
                    <td><!-- TODO: Edit/Delete buttons --></td>
                </tr>
            {% else %}
                <tr><td colspan="8" class="text-center">No phases defined yet.</td></tr>
            {% endfor %}
            </tbody>
        </table>
        <!-- TODO: Add phase creation/edit form here -->
    {% endif %}
</div>
{% endblock %}
